name: contract-tests

on:
  push:
  pull_request:

jobs:
  contract-tests:
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Download Godot (headless)
        shell: bash
        run: |
          set -euo pipefail
          GODOT_VERSION="4.5.1-stable"
          ZIP="Godot_v${GODOT_VERSION}_linux.x86_64.zip"
          URL="https://github.com/godotengine/godot/releases/download/${GODOT_VERSION}/${ZIP}"
          echo "Downloading $URL"
          curl -L "$URL" -o godot.zip
          unzip -q godot.zip -d godot
          chmod +x godot/Godot_v${GODOT_VERSION}_linux.x86_64

      - name: Run contract tests
        shell: bash
        run: |
          set -euo pipefail
          ./godot/Godot_v4.5.1-stable_linux.x86_64 --headless --quit --path . --script res://tests/run_contract_tests.gd
